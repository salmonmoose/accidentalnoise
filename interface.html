<html>
	<head>
		<script type="text/javascript">
			workspace = [];

			window.onload = function() {
				optionslist = AccidentalNoiseSequence.getLayerOptions();

				console.debug(optionslist);

				optionslist.forEach(function(layer) {
					console.log(layer);
				});

				toolbox = document.getElementById('toolbox');

				optionslist.forEach(function(layer) {
					new_li = document.createElement("li");
					button = document.getElementById("tool_button").cloneNode(true);

					button.setAttribute('id', layer+'_interface');
					button.style.display='inline';

					button.querySelector('img').src = 'noise://'+layer+'_interface?x=50&y=50';
					button.onclick = function() { createLayer(layer); };
					button.querySelector('h2').innerHTML = layer;

					new_li.appendChild(button);

					toolbox.querySelector('ul').insertBefore(new_li);
				});
			};

			inputList = function(list) {
				new_ul = document.createElement("ul");

				list.forEach(function(input) {
					split = input.split(':');
					new_li = document.createElement("li");

					value = AccidentalNoiseSequence.getLayerInputValue(split[0], split[1], split[2]);

					new_li.innerHTML =
						'<span>'+split[2]+':</span>'+
						'<input type="text" value="'+value+'" name="'+input+'" id="'+input+'" onkeyup="updateLayer(\''+input+'\');">';

					new_ul.appendChild(new_li);
				});

				return new_ul;
			};

			updateLayer = function(id) {
				console.debug('updateLayer');
				split = id.split(':');
				layer = document.getElementById(split[0]);

				value = document.getElementById(id).value;

				AccidentalNoiseSequence.setLayerInputValue(split[0], split[1], split[2], value);

				layer.querySelector('img').src = 'noise://'+split[0]+'?x=100&y=100&' + new Date().getTime();
			};

			createLayer = function(type) {

				name = (type+"_"+makeid()).toLowerCase();

				console.debug(type, name);

				workspace.push(name);

				AccidentalNoiseSequence.createLayer(type, name);

				node = document.getElementById("noise_node").cloneNode(true);

				node.setAttribute('id', name);

				node.querySelector('img').src = 'noise://'+name+'?x=100&y=100&' + new Date().getTime();
				node.querySelector('p').innerHTML = type+"["+name+"]";

				nodeDoubleInputList = AccidentalNoiseSequence.getLayerDoubleInputs(name);
				nodeIntInputList = AccidentalNoiseSequence.getLayerIntInputs(name);
				nodeNoiseInputList = AccidentalNoiseSequence.getLayerNoiseInputs(name);

				node.querySelector('.inputs').appendChild(inputList(nodeDoubleInputList));
				node.querySelector('.inputs').appendChild(inputList(nodeIntInputList));
				node.querySelector('.inputs').appendChild(inputList(nodeNoiseInputList));

				document.getElementById('workspace').appendChild(node);
			};

			makeid = function() {
				var text = "";
				var possible = "abcdef0123456789";

				for (var i = 0; i < 8; i++ ) {
					text += possible.charAt(Math.floor(Math.random() * possible.length));
				}

				return text;
			};
		</script>
		<style>
body
{
	background-color: rgb(127,127,127);
}

#toolbox
{

}

#toolbox ul
{
	margin: 0;
	padding: 0;
	list-style-type: none;
	text-align: center;
}

#toolbox ul li
{
	display: inline;
}

#toolbox ul li a
{
	text-decoration: none;
	padding: 0;
	background-color: rgb(95,95,95);
}

#toolbox h2
{
	display: inline;
	font-size: 12;
}
		</style>
	</head>
	<body>
		<div id="toolbox">
			<ul>
			</ul>
		</div>
		<div id="workspace">

		</div>
		<div id="tool_button" style="display: none;">
			<a href="#">
				<img/>
				<h2></h2>
			</a>
		</div>
		<div id="noise_node">
			<div class="handle">
				<p></p>
			</div>
			<div class="node">
				<img/>
			</div>
			<div class="inputs">

			</div>
		</div>
	</body>
</html>